<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Drag and drop test</title>
    <style>
      html,
      body {
        width: 100vw;
        max-width: 100vw;
        height: 100vh;
        max-height: 100vh;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
      }

      #outerContainer {
        box-sizing: border-box;
        padding: 20px;
        flex-grow: 1;
      }

      #container {
        width: 100%;
        height: 100%;
        background-color: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        border-radius: 7px;
        touch-action: none;
        position: relative;
      }

      .item {
        touch-action: none;
        user-select: none;
        position: relative;
        cursor: pointer;
      }

      .item:active {
        opacity: 0.75;
      }

      .item:hover {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <ul>
      <li><a href="../">Back</a></li>
    </ul>
    <div id="outerContainer">
      <div id="container"></div>
    </div>

    <script>
      const COLORS = ["#333333", "#E9D2F4", "#F4E663", "#C4F1BE"];
      const mockData = [
        {
          idx: 1,
          h: 200,
          r: 0,
          w: 200,
          x: 200,
          y: 0,
          shapeType: "rectangle",
          text: "Rectangle 1"
        },
        {
          idx: 2,
          h: 0,
          r: 50,
          w: 0,
          x: 0,
          y: 100,
          shapeType: "circle",
          text: "Circle 1"
        }
      ];

      const container = document.querySelector("#container");
      generateShapes(mockData);
      let activeItem = null;

      let active = false;

      container.addEventListener("touchstart", dragStart, false);
      container.addEventListener("touchend", dragEnd, false);
      container.addEventListener("touchmove", drag, false);

      container.addEventListener("mousedown", dragStart, false);
      container.addEventListener("mouseup", dragEnd, false);
      container.addEventListener("mousemove", drag, false);

      function dragStart(e) {
        console.log("dragStart");
        if (e.target === e.currentTarget) return;

        active = true;
        activeItem = e.target;

        if (!activeItem) return;

        if (!activeItem.xOffset) {
          activeItem.xOffset = 0;
        }

        if (!activeItem.yOffset) {
          activeItem.yOffset = 0;
        }

        if (e.type === "touchstart") {
          activeItem.initialX = e.touches[0].clientX - activeItem.xOffset;
          activeItem.initialY = e.touches[0].clientY - activeItem.yOffset;
        } else {
          // console.log("doing something!");
          activeItem.initialX = e.clientX - activeItem.xOffset;
          activeItem.initialY = e.clientY - activeItem.yOffset;
        }
      }

      function dragEnd(e) {
        console.log("dragEnd");
        if (activeItem !== null) {
          activeItem.initialX = activeItem.currentX;
          activeItem.initialY = activeItem.currentY;
        }

        active = false;
        activeItem = null;
      }

      function drag(e) {
        console.log("drag");
        if (!active) return;

        e.preventDefault();
        // console.dir(activeItem);

        if (e.type === "touchmove") {
          activeItem.currentX = e.touches[0].clientX - activeItem.initialX;
          activeItem.currentY = e.touches[0].clientY - activeItem.initialY;
        } else {
          activeItem.currentX = e.clientX - activeItem.initialX;
          activeItem.currentY = e.clientY - activeItem.initialY;
        }

        activeItem.xOffset = activeItem.currentX;
        activeItem.yOffset = activeItem.currentY;

        activeItem.style.transform =
          "translate3d(" +
          activeItem.currentX +
          "px, " +
          activeItem.currentY +
          "px, 0)";
      }

      function generateShapes(shapes) {
        shapes.forEach(shape => {
          const el = document.createElement("div");
          el.style.position = "absolute";
          if (shape.shapeType === "rectangle") {
            el.style.width = `${shape.w}px`;
            el.style.height = `${shape.h}px`;
          } else if (shape.shapeType === "circle") {
            el.style.width = `${shape.r * 2}px`;
            el.style.height = `${shape.r * 2}px`;
            el.style.borderRadius = "50%";
          }
          el.style.left = `${shape.x}px`;
          el.style.top = `${shape.y}px`;
          el.style.backgroundColor = COLORS[shape.idx % COLORS.length];
          el.setAttribute("class", "item");
          container.appendChild(el);
        });
      }
    </script>
  </body>
</html>
